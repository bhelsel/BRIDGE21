



```{r decide whether to show cognition based on available kuadrc or bold data}
#| echo: false
#| eval: !expr (params$kuadrc_cognition) | (params$bold_cognition) | (params$abcds_cognition) | (params$trcds_cognition)
#| results: asis

BRIDGE21::format_quarto(type = "newpage")
# Down Syndrome Mental Status Exam
dsmse_variables <- c(
  "dsmsett|dsmsett2|dsto2",
  "dsvistt|dsvistt2|dsvs1",
  "dssmtot|dssmtot2|colshbx",
  "dsmmtot|dsmmtot2|dsme1",
  "dslgtot|dslgtot2|dsla2"
)

dsmse_df <- BRIDGE21::get_database_values(
  !!!dsmse_variables,
  date = date,
  data = data
)

if (all(apply(dsmse_df[setdiff(colnames(dsmse_df), date)], 2, is.na))) {
  params$kuadrc_dsmse <- params$bold_dsmse <- params$abcds_dsmse <- FALSE
}


# Modified Cued Recall Test
mcrt_variables <- c("dscrttfr|frss", "dscrttcr|dsccttcr|crss")
mcrt_df <- BRIDGE21::get_database_values(
  !!!mcrt_variables,
  date = date,
  data = data
)


if (
  all(apply(mcrt_df[setdiff(colnames(mcrt_df), date)], 2, is.na)) |
    all(mcrt_df[setdiff(colnames(mcrt_df), date)] == 0, na.rm = TRUE)
) {
  params$kuadrc_mcrt <- params$bold_mcrt <- FALSE
}

# National Task Group - Early Detection and Screen for Dementia (NTG-EDSD)
if (params$kuadrc_ntgedsd | params$bold_ntgedsd) {
  ntgedsd_names <- colnames(dplyr::select(data, dsadl1:dsother6))
} else if (params$abcds_ntgedsd | params$trcds_ntgedsd) {
  ntgedsd_names <- c(
    "adl|adltot",
    "lang|ntlctot",
    "sleep|ntswtot",
    "amb|ntambtot",
    "mem|ntmemtot",
    "beh|ntbehtot",
    "self|ntsrptot",
    "other|ntootot"
  )
}

ntgedsd_df <- BRIDGE21::get_database_values(
  !!!ntgedsd_names,
  date = date,
  data = data
)

if (rlang::is_empty(ntgedsd_df)) {
  params$kuadrc_ntgedsd <- params$bold_ntgedsd <- params$abcds_ntgedsd <- params$trcds_ntgedsd <- FALSE
}


# Vineland Adaptive Behavior Scale
vineland_variables <- c(
  "vnld_abcss",
  "vnld_commss",
  "vnld_dlivss",
  "vnld_soclss"
)

if (params$bold_cognition) {
  vineland_df <- BRIDGE21::get_database_values(
    !!!vineland_variables,
    date = date,
    data = data
  )
  if (all(apply(vineland_df[, vineland_variables], 2, is.na))) {
    params$bold_vineland <- FALSE
  }
}

after_memory_section <-
  (params$kuadrc_dsmse & !params$kuadrc_mcrt) |
  (params$bold_dsmse & !params$bold_mcrt) |
  (params$abcds_dsmse & !params$abcds_mcrt) |
  (params$trcds_dsmse & !params$trcds_mcrt)

kuadrc_cognition <- paste0("kuadrc_", c("dsmse", "mcrt", "ntgedsd"))
bold_cognition <- paste0("bold_", c("dsmse", "mcrt", "ntgedsd", "vineland"))
abcds_cognition <- paste0("abcds_", c("dsmse", "mcrt", "ntgedsd"))
trcds_cognition <- paste0("trcds_", c("dsmse", "mcrt", "ntgedsd"))

if (
  any(unlist(params[kuadrc_cognition])) |
    any(unlist(params[bold_cognition])) |
    any(unlist(params[abcds_cognition])) |
    any(unlist(params[trcds_cognition]))
) {
  BRIDGE21::format_quarto(
    "MEMORY AND THINKING TEST SCORES",
    type = "section"
  )
}

```

<!--- Down Syndrom Mental Status Exam --->

{{< include sections/cognition/components/dsmse.qmd >}}

<!--- Modified Cued Recall Test --->

{{< include sections/cognition/components/mcrt.qmd >}}

<!--- National Task Group - Early Detection and Screen for Dementia (NTG-EDSD) --->

{{< include sections/cognition/components/ntgedsd.qmd >}}

<!--- Vineland Adaptive Behavior Scale --->

{{< include sections/cognition/components/vineland.qmd >}}