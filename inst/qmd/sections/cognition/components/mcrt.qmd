---
editor_options: 
  chunk_output_type: console
---

```{r display mcrt calculated scores from the kuadrc cohort or bold study, ft.align="left"}
#| echo: false
#| results: asis
#| eval: !expr (params$kuadrc_mcrt) | (params$bold_mcrt) | (params$abcds_mcrt) | (params$trcds_mcrt)

BRIDGE21::format_quarto(
  "sections/cognition/latex/cued-recall.tex",
  type = "input"
)

mcrt_df <- mcrt_df %>%
  BRIDGE21::format_date(!!date_expr) %>%
  dplyr::mutate(dscrttr = dscrttfr + dscrttcr, .after = 1)


if (nrow(mcrt_df) == 1) {
  mcrt_decline <- FALSE
} else {
  mrctMaxDateIndex <- find_max_date(mcrt_df)
  recentMCRT <- mcrt_df[mrctMaxDateIndex, "dscrttr", drop = TRUE]
  previousMCRT <- mcrt_df[mrctMaxDateIndex - 1, "dscrttr", drop = TRUE]
  percentDiffMCRT <- ((recentMCRT - previousMCRT) / previousMCRT) * 100
  mcrt_decline <- percentDiffMCRT < -10
}

mcrt_labels <- c("Total Recall", "Free Recall", "Cued Recall")

mcrt_df %>%
  flextable::flextable() %>%
  flextable::set_header_labels(values = c("Date", mcrt_labels)) %>%
  flextable::width(j = 1:4, width = 1.6) %>%
  flextable::align(j = 1:4, align = "center", part = "all") %>%
  flextable::bold(j = 1:4, part = "header") %>%
  flextable::add_footer_row(values = "Max Score: 36", colwidths = 4)


if (!after_memory_section) {
  BRIDGE21::format_quarto(
    "sections/cognition/latex/after-memory.tex",
    type = "input"
  )
}

```

