---
editor_options: 
  chunk_output_type: console
---

```{r display dsmse calculated scores from the kuadrc cohort and bold study, ft.align="left"}
#| echo: false
#| results: asis
#| eval: !expr (params$kuadrc_dsmse) | (params$bold_dsmse) | (params$abcds_dsmse) | (params$trcds_dsmse)

BRIDGE21::format_quarto("sections/cognition/latex/dsmse.tex", type = "input")

dsmse_df <- BRIDGE21::format_date(dsmse_df, !!date_expr)

if (nrow(dsmse_df) == 1) {
  dsmse_decline <- FALSE
} else {
  dsmseMaxDateIndex <- find_max_date(dsmse_df)
  recentDSMSE <- dsmse_df[dsmseMaxDateIndex, "dsmsett", drop = TRUE]
  previousDSMSE <- dsmse_df[dsmseMaxDateIndex - 1, "dsmsett", drop = TRUE]
  percentDiffDSMSE <- ((recentDSMSE - previousDSMSE) / previousDSMSE) * 100
  dsmse_decline <- percentDiffDSMSE < -10
}

dsmse_labels <- c("Total Score", "Visual Spatial", "Memory", "Language")

dsmse_df %>%
  dplyr::mutate(dsmemtot = dssmtot + dsmmtot) %>%
  dplyr::select(Date, dsmsett, dsvistt, dsmemtot, dslgtot) %>%
  flextable::flextable() %>%
  flextable::set_header_labels(values = c("Date", dsmse_labels)) %>%
  flextable::width(j = 1:5, width = 1.3) %>%
  flextable::align(j = 1:5, align = "center", part = "all") %>%
  flextable::bold(j = 1:5, part = "header") %>%
  flextable::add_footer_row(values = "Max Score: 103", colwidths = 5)


if (
  all(unlist(params[c("kuadrc_dsmse", "kuadrc_mcrt")])) |
    all(unlist(params[c("bold_dsmse", "bold_mcrt")])) |
    all(unlist(params[c("abcds_dsmse", "abcds_mcrt")])) |
    all(unlist(params[c("trcds_dsmse", "trcds_mcrt")]))
) {
  BRIDGE21::format_quarto(type = "newpage")
}


if (after_memory_section) {
  BRIDGE21::format_quarto(
    "sections/cognition/latex/after-memory.tex",
    type = "input"
  )
}

```
