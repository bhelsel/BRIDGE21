```{r controller to decide whether to display the kuadrc imaging sections}
#| echo: false
#| eval: !expr (params$kuadrc_mri) | (params$kuadrc_pet)
#| results: asis

params$kuadrc_pet <- FALSE

imageFiles <- list.files(
  params$imagedir,
  pattern = ".png$",
  recursive = TRUE,
  full.names = TRUE
)

imaging <- BRIDGE21::get_database_values(
  redcap_repeat_instrument,
  radiology_read,
  data = data,
  date = "scan_date",
  event_name = redcap_event_name
)

if (
  rlang::is_empty(imageFiles) |
    BRIDGE21::check_missing_values(imaging, "scan_date")
) {
  params$kuadrc_mri <- FALSE
} else {
  axialImage <- paste0("{", imageFiles[grep("axial", imageFiles)], "}")
  sagittalImage <- paste0("{", imageFiles[grep("sagittal", imageFiles)], "}")
}

if (params$kuadrc_mri | params$kuadrc_pet) {
  BRIDGE21::format_quarto("IMAGING SCANS", type = "section")
}

```

```{r controller to decide whether to display the pet imaging sections}
#| echo: false
#| eval: !expr (params$kuadrc_pet) | (params$trcds_pet)
#| results: asis

abeta_df <- BRIDGE21::get_database_values(
  "centiloid|centiloid_apet",
  date = date,
  data = data
)

if (
  all(apply(abeta_df[setdiff(colnames(abeta_df), date)], 2, is.na)) |
    all(abeta_df[setdiff(colnames(abeta_df), date)] == 0, na.rm = TRUE) |
    nrow(abeta_df) == 0
) {
  params$kuadrc_pet <- params$trcds_pet <- FALSE
}

# abeta_df$img_scan_date_apet <- format(
#   as.Date(abeta_df$img_scan_date_apet, tryFormats = c("%m/%d/%y", "%m/%d/%Y")),
#   "%B %d, %Y"
# )

```

<!--- MRI Imaging --->

{{< include sections/imaging/components/mri.qmd >}}

<!--- PET Imaging --->

{{< include sections/imaging/components/pet.qmd >}}

