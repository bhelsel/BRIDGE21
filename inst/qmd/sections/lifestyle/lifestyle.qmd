---
editor_options: 
  chunk_output_type: console
---

```{r controller to determine what lifestyle sections would have data for the kuadrc cohort or bold study}
#| echo: false
#| results: asis
#| eval: !expr (params$kuadrc_lifestyle) | (params$bold_lifestyle)

BRIDGE21::format_quarto("LIFESTYLE AND DISEASE RISK", type = "section")

BRIDGE21::format_quarto(
  BRIDGE21::add_string(
    "We assessed various measures that can affect your overall brain health. " +
      "Recent research suggests that a healthy lifestyle is a key components of brain health."
  ),
  type = "strwrap"
)

# Blood Pressure

blood_pressure <-
  BRIDGE21::get_database_values(
    !!!date,
    "bpsys|bpsysl1",
    "bpdias|bpdiasl1",
    data = data
  )

if (BRIDGE21::check_missing_values(blood_pressure, date)) {
  params$kuadrc_blood_pressure <- params$bold_blood_pressure <- FALSE
}

# Physical Activity

if (!is.null(params$accelres)) {
  accel_df <- tryCatch(
    {
      accelMetaDir <- file.path(params$accelres, "output_data", "meta")
      accelResDir <- file.path(params$accelres, "output_data", "results")
      dayMMFile <- list.files(accelResDir, "day.*MM", full.names = TRUE)
      BRIDGE21:::retrieve_accel_summary(
        readr::read_csv(
          dayMMFile,
          show_col_types = FALSE
        )
      )
    },
    error = function(e) {
      params$kuadrc_activity <- params$bold_activity <- FALSE
    }
  )
} else {
  params$kuadrc_activity <- params$bold_activity <- FALSE
}

# Body Mass Index

if (params$kuadrc_bmi) {
  anthrovars <- c("weight", "height")
} else {
  anthrovars <- c("average_weight", "average_height")
}

anthro <- BRIDGE21::get_database_values(!!!anthrovars, data = data)

check_missing_wt_ht <- function(wt, ht) {
  len <- c(wt = length(wt), ht = length(ht))
  noWtHt <- (len[["wt"]] == 0 | len[["ht"]] == 0) | len[["wt"]] != len[["ht"]]
  return(data.frame(lenWt = len[["wt"]], lenHt = len[["ht"]], noWtHt))
}

bmiCheck <- check_missing_wt_ht(anthro[[1]], anthro[[2]])

if (bmiCheck[["noWtHt"]]) {
  params$kuadrc_bmi <- params$bold_bmi <- FALSE
}

# DXA Scan

dxaNames <- dxaVars <- c("mass", "lean", "fat", "total_fat", "dxa_bmd_z")

if (params$bold_dxa) {
  dxaVars <- c(
    "dxa_total_kg",
    "dxa_lean_g",
    "dxa_fat_g",
    "dxa_fat_percent",
    "dxa_bmd_z"
  )
}

dxa <- BRIDGE21::get_database_values(!!!date, !!!dxaVars, data = data)

if (BRIDGE21::check_missing_values(dxa, date)) {
  params$kuadrc_dxa <- params$bold_dxa <- FALSE
}

```


{{< include sections/lifestyle/components/bp.qmd >}}

{{< include sections/lifestyle/components/activity.qmd >}}

{{< include sections/lifestyle/components/bmi.qmd >}}

{{< include sections/lifestyle/components/dxa.qmd >}}

{{< include sections/lifestyle/components/veggiemeter.qmd >}}

