``` {r display text and plot for the accelerometer data for the kuadrc cohort and bold study}
#| echo: false
#| results: asis
#| eval: !expr (params$kuadrc_activity) | (params$bold_activity)

BRIDGE21::format_quarto("sections/lifestyle/latex/activity.tex", type = "input")

IMPFiles <- list.files(
  file.path(accelMetaDir, "ms2.out"),
  recursive = TRUE,
  full.names = TRUE,
  pattern = "\\.RData$"
)

for (IMP in IMPFiles) {
  baseIMP <- gsub(".RData$", "", basename(IMP))
  accel_df_subset <- accel_df[accel_df$filename == baseIMP, ]
  accelDates <- as.Date(accel_df_subset$date, format = "%m/%d/%Y")
  minDate <- format(min(accelDates), "%B %d, %Y")
  maxDate <- format(max(accelDates), "%B %d, %Y")

  BRIDGE21::format_quarto(
    sprintf("Activity Data from %s to %s", minDate, maxDate),
    type = "subsection"
  )

  success <- sum(
    accel_df_subset$dur_spt_min >= 480 &
      accel_df_subset$dur_day_total_MVPA_min >= 30
  )

  BRIDGE21::format_quarto(
    sprintf(
      "You met the sleep and physical activity goals on **%d out of %d days**\n\n",
      success,
      nrow(accel_df_subset)
    ),
    type = "strwrap"
  )

  accel_plot <- BRIDGE21::plot_time_series_by_date(
    IMP,
    summary_data = accel_df_subset
  )

  accelerometer_file_name <- sprintf("%s.png", baseIMP)

  ggplot2::ggsave(
    filename = accelerometer_file_name,
    accel_plot,
    width = 11,
    height = 8,
    dpi = 300
  )

  paste0("", "![](", accelerometer_file_name, ")", "") |>
    cat(sep = "\n")

  BRIDGE21::format_quarto(type = "newpage")
}

```