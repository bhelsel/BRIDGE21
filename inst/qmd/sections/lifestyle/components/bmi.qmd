```{r display body mass index table and plot for the kuadrc cohort and bold study, ft.align = "left"}
#| echo: false
#| results: asis
#| fig-align: center
#| eval: !expr (params$kuadrc_bmi) | (params$bold_bmi)

if (params$kuadrc_bmi) {
  anthro <- BRIDGE21::calculate_bmi(anthro, weight, height, units = "imperial")
} else if (params$bold_bmi) {
  anthro <- BRIDGE21::calculate_bmi(
    anthro,
    average_weight,
    average_height,
    units = "metric"
  )
}


ltex <- paste(
  readLines("sections/lifestyle/latex/bmi.tex"),
  collapse = "\n"
)


ltex <- glue::glue(
  ltex,
  bmiLast = round(anthro[[bmiCheck$lenWt, "bmi"]], 1),
  .open = "{{",
  .close = "}}"
)

cat(paste0("", ltex, ""), sep = "\n")

bmi_plot <- BRIDGE21::generate_bmi_arch_plot(
  anthro[[bmiCheck$lenWt, 1]],
  anthro[[bmiCheck$lenHt, 2]]
)

# Adjust alignment on Quarto ouput
bmi_plot <- bmi_plot +
  ggplot2::theme(plot.margin = ggplot2::margin(t = -40, r = -45))

ggplot2::ggsave(
  filename = "bmi_plot.png",
  bmi_plot,
  width = 6,
  height = 3,
  dpi = 300
)

weight_plot <- BRIDGE21::generate_weight_bar_plot(
  anthro[[bmiCheck$lenWt, 1]],
  anthro[[bmiCheck$lenHt, 2]]
)

ggplot2::ggsave(
  filename = "weight_plot.png",
  weight_plot,
  width = 8,
  height = 2,
  dpi = 300
)

paste("", "![](bmi_plot.png)", "\n\n", "![](weight_plot.png)") |>
  cat(sep = "\n")

BRIDGE21::format_quarto(type = "newpage")

```

